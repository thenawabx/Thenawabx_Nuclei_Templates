id: advanced-ssti-waf-bypass

info:
  name: Advanced SSTI Detector (WAF Bypass)
  author: thenawabx
  severity: critical
  description: Targeted at multiple template engines (Jinja2, Twig, Smarty) using mathematical payloads to confirm execution.
  tags: ssti, advanced, waf-bypass, rce

http:
  - method: GET
    path:
      - "{{BaseURL}}/?name={{payload}}"
      - "{{BaseURL}}/?id={{payload}}"
      - "{{BaseURL}}/?q={{payload}}"

    payloads:
      payload:
        # 1. Jinja2/Twig (Standard Math)
        - "{{7*7}}"
        # 2. Advanced Jinja2 Bypass (Using underscore and brackets)
        - "{{7['multiply'](7)}}"
        # 3. Smarty Template Bypass
        - "{self::get_defined_constants()}{7*7}"
        # 4. Mako/ERB style
        - "<%= 7 * 7 %>"
        # 5. Handlebars/Mustache
        - "{{{7*7}}}"

    stop-at-first-match: true

    matchers-condition: and
    matchers:
      # Verifies if the mathematical operation 7*7 resulted in 49
      - type: word
        part: body
        words:
          - "49"

      # Ensures generic mathematical 49 isn't already on the page
      - type: word
        part: body
        negative: true
        words:
          - "7*7"

      # Ensures successful 200 OK status
      - type: status
        status:
          - 200
